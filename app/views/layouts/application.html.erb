<!DOCTYPE html>
<html>
<head>
  <title><%= _("Aalto Apps") %></title>
  <%= stylesheet_link_tag :all %>
  <%= javascript_include_tag :defaults %>
  <%= csrf_meta_tag %>

  <script type="text/javascript" src="http://jqueryjs.googlecode.com/files/jquery-1.3.2.min.js"></script>
  <script type="text/javascript">
    function submenuOpen(j) {
      j .parent('.menutop') .removeClass('menutop-closed') .addClass('menutop-open');
      j .removeClass('menutop-closed') .addClass('menutop-open') .parents('li') .children('ul') .slideDown(250);
    }

    function submenuClose(j) {
      j .removeClass('menutop-open') .addClass('menutop-closed')  .parents    ('li') .children('ul') .slideUp(250);
      j .parent('.menutop') .removeClass('menutop-open') .addClass('menutop-closed');
    }

    $(document).ready(function() {
      // update open/closed status of menus from cookie
      $.each(document.cookie.split(';'), function (i, cookie) {
        var match = $.trim(cookie).match(/^openMenus=([a-zA-Z0-9_,-]+)$/);
        if (match) {
          $.each(match[1].split(','), function (i, id) {
            $('#menu #' + id + ' .menutop') .addClass('menutop-open');
          });
        }
      });

      $('.menutop:not(.menutop-open)') .addClass('menutop-closed') .parents('li') .children('ul') .hide();

      $('#menu .menutop') .click(function() {

        if ($(this) .hasClass('menutop-open')) {
          submenuClose($(this));
        }else{
          submenuClose($('#menu .menutop-open'));
          submenuOpen($(this));
        }

        // set cookie to a list of ids of open menus
        document.cookie =
          'openMenus=' +
          $('#menu .menutop-open').parent().map(function() { return this.id; }).get().join(',') +
          '; path=/';

        return false;
      });
    });
  </script>


</head>
<body>
    <div class="wrapper_top">
    	<div class="layout_info">
				<div class="layout_menuitem">
          Choose language: English, suomi
        </div>
				<div class="layout_menuitem">
          <%= render :partial => "/users/login_menu" %>
        </div>
				<div class="layout_menuitem">
					<%=render :partial=>"/products/search"%>
				</div>
			</div>
		  <div class="layout_logo">
		    <%= link_to _("aalto apps"), root_path %>
		  </div>
			<div class="layout_line"></div>
		</div>
			

		

    <div class="wrapper_bottom">

          <div class="layout_frame">
            <div class="layout_master">
				      <div id="notice"><%= notice %></div>
            	<div id="alert"><%= alert %></div>
              <%= yield %>
            </div>

            <div class="layout_footer">
              <%= _("Official looking footer here") %>
            </div>
          </div>


          <div id="menu">
  		      <div class="navmenu">
    		      <li><div class="menusingle"><%= link_to _("home"), root_path %></div></li>
				      <li id="menu-browse"><div class="menutop"><%= link_to _("browse") %> </div>
          		  <ul>
                  <div class="submenu">
  							    <li class="submenu_row"><%=link_to _("All"), products_path %> </li>
						        <% Platform.all.each do |platform|%>
										<li class="submenu_row"><%=link_to platform.name, "/platforms/%{p_id}/products/" % {:p_id => platform.id} %> </li>
		     				    <%end%>
          		    </div>
                </ul>
                                      </li>
					    <% if logged_in? %>
          		<li id="menu-publish">
                <div class="menutop"><%= link_to _("publish") %></div>
							    <ul>
                    <div class="submenu">
							        <li class="submenu_row"><%=link_to _("My Apps"), products_path(:myapps=>true) %> </li>		
            			    <li class="submenu_row"><%=link_to _("New App"), new_product_path %> </li>
							      </div>
                  </ul>
					    </li>
        				<% end %>
    		
 			      </ul>
 		      </div>

          
    </div>
    	


</body>
</html>
